# Instructions Copilot - Cartoscope Hugo

## üéØ Contexte du projet

**Cartoscope Hugo** est un site statique combinant narration et exploration cartographique pour visualiser l'√©volution d√©mographique et administrative de milliers de lieux en France (1790-1982).

### Architecture technique
- **Frontend** : Hugo (SSG) + Leaflet (cartographie)
- **Donn√©es** : Quarto + Python (pipeline ETL)
- **Layout** : 2 colonnes (texte/graphiques | carte interactive)
- **D√©ploiement** : GitHub Pages
- **Donn√©es sources** : CSV r√©gionaux avec s√©ries temporelles

## üìã Feuille de route

### ‚úÖ √âtape 0 : Initialisation Git & d√©ploiement
- [x] Repository Git initialis√©
- [x] .gitignore configur√©
- [x] GitHub Pages configur√©
- [x] Instructions Copilot r√©dig√©es

### üì¶ √âtape 1 : Squelette Hugo (PRIORIT√â 1)
**Objectif** : Structure de base fonctionnelle
**Dur√©e estim√©e** : 30-45 min

**T√¢ches** :
- [ ] `config.toml` Hugo (lang=fr, baseURL GitHub Pages)
- [ ] Arborescence compl√®te (layouts, content, static)
- [ ] Leaflet + MarkerCluster dans `static/lib/`
- [ ] Layout 2 colonnes responsive (`layouts/_default/single.html`)
- [ ] Partiel carte (`layouts/partials/map.html`)
- [ ] Page d'accueil (`content/_index.md`)

**DoD** : Site Hugo buildable avec fond de carte OSM

### üîÑ √âtape 2 : Pipeline ETL (PRIORIT√â 1)
**Objectif** : CSV Eure-et-Loire ‚Üí JSON/GeoJSON
**Dur√©e estim√©e** : 1-2 heures

**T√¢ches** :
- [ ] `quarto/pipeline.qmd` avec code Python
- [ ] Nettoyage donn√©es (`lac.`, `n_c`, `s_o`, `!` ‚Üí null/flags)
- [ ] Parsing colonnes `V_*` ‚Üí (year, suffix, value)
- [ ] Structure de sortie (3 fichiers JSON par r√©gion)
- [ ] Gestion coordonn√©es (pr√©paration jointure future)

**Fichiers g√©n√©r√©s** :
- `static/data/eure-et-loir.geojson`
- `static/data/eure-et-loir-series.json` 
- `static/data/eure-et-loir-aggregates.json`

### üìÑ √âtape 3 : Page r√©gion d√©mo (PRIORIT√â 2)
**Objectif** : Premi√®re page fonctionnelle
**Dur√©e estim√©e** : 45 min

**T√¢ches** :
- [ ] `content/regions/eure-et-loir.qmd`
- [ ] Front matter (`region: eure-et-loir`, params par d√©faut)
- [ ] Graphique √©volution d√©mographique (Quarto/Python)
- [ ] Synchronisation carte-contenu

### üéõÔ∏è √âtape 4 : Contr√¥les interactifs (PRIORIT√â 2)
**Objectif** : Timeline + s√©lecteurs
**Dur√©e estim√©e** : 1 heure

**T√¢ches** :
- [ ] Slider ann√©es (1790-1982)
- [ ] Select suffixes (h, f, tot, masc, etc.)
- [ ] Synchronisation URL (?year=1850&suffix=h)
- [ ] Mise √† jour dynamique marqueurs
- [ ] Popups enrichies

### üìà √âtape 5 : Normalisation avanc√©e (PRIORIT√â 3)
**Objectif** : Gestion calendrier r√©publicain & suffixes compos√©s
**Dur√©e estim√©e** : 1 heure

**T√¢ches** :
- [ ] Dictionnaire `data/dicts/republican-years.csv`
- [ ] Parser `V_an_*` ‚Üí ann√©es gr√©goriennes
- [ ] Suffixes compos√©s (`_f_tot`, `_f_masc`)
- [ ] Rapport qualit√© `data-quality/<region>.md`

### ‚ö° √âtape 6 : Performance (PRIORIT√â 3)
**Objectif** : Optimisation chargement/rendu
**Dur√©e estim√©e** : 45 min

**T√¢ches** :
- [ ] Clustering automatique (>500 points)
- [ ] Minification JSON
- [ ] Lazy loading Chart.js
- [ ] Audit poids (<3Mo/r√©gion)

### ‚úÖ √âtape 7 : QA & accessibilit√© (PRIORIT√â 4)
**Objectif** : Tests & finalisation
**Dur√©e estim√©e** : 30 min

**T√¢ches** :
- [ ] Tests build Hugo/Quarto
- [ ] Validation JSON/GeoJSON
- [ ] Accessibilit√© (clavier, contrastes)
- [ ] Documentation

## üóÇÔ∏è Structure des fichiers

```
.
‚îú‚îÄ‚îÄ .github/workflows/          # CI/CD GitHub Pages
‚îú‚îÄ‚îÄ config.toml                 # Configuration Hugo
‚îú‚îÄ‚îÄ content/
‚îÇ   ‚îú‚îÄ‚îÄ _index.md              # Page d'accueil
‚îÇ   ‚îî‚îÄ‚îÄ regions/
‚îÇ       ‚îî‚îÄ‚îÄ eure-et-loir.qmd   # Pages r√©gions
‚îú‚îÄ‚îÄ layouts/
‚îÇ   ‚îú‚îÄ‚îÄ _default/single.html   # Template 2 colonnes
‚îÇ   ‚îî‚îÄ‚îÄ partials/map.html      # Carte Leaflet
‚îú‚îÄ‚îÄ static/
‚îÇ   ‚îú‚îÄ‚îÄ data/                  # Donn√©es g√©n√©r√©es (JSON/GeoJSON)
‚îÇ   ‚îî‚îÄ‚îÄ lib/                   # Leaflet, MarkerCluster
‚îú‚îÄ‚îÄ quarto/
‚îÇ   ‚îú‚îÄ‚îÄ pipeline.qmd           # ETL Python CSV‚ÜíJSON
‚îÇ   ‚îî‚îÄ‚îÄ _quarto.yml           # Config Quarto
‚îî‚îÄ‚îÄ data/
    ‚îú‚îÄ‚îÄ *.csv                  # Sources par r√©gion
    ‚îî‚îÄ‚îÄ coords/                # Coordonn√©es (futur)
```

## üé® Sp√©cifications techniques

### Format des donn√©es
- **GeoJSON** : Features avec propri√©t√©s (admin, series, flags)
- **Series JSON** : Format long/tidy pour graphiques
- **Aggregates JSON** : Pr√©-calculs r√©gionaux

### UI/UX
- **Responsive** : Carte sous texte en mobile (<920px)
- **Carte** : France [46.6, 2.2], zoom 6, OSM
- **Marqueurs** : Rayon proportionnel ‚àö(value)/10
- **Timeline** : Slider + select, URL synchronis√©e

### Conventions de nommage
- **R√©gions** : kebab-case (`eure-et-loir`)
- **Fichiers** : `<region-slug>.(geojson|series.json|aggregates.json)`
- **Front matter** : `region`, `params.year`, `params.suffix`

## üöÄ Commandes utiles

```bash
# Build Hugo
hugo

# Render Quarto
quarto render quarto/pipeline.qmd

# Pipeline complet
quarto render && hugo

# D√©veloppement local
hugo server -D
```

## üîó Ressources

- **Sp√©cifications compl√®tes** : `specifications_llm_site_statique_datavis_carto_hugo_quarto_leaflet.md`
- **Donn√©es exemple** : `data/Eure_et_Loire.csv`
- **Documentation Hugo** : https://gohugo.io/
- **Documentation Quarto** : https://quarto.org/
- **Documentation Leaflet** : https://leafletjs.com/

## ‚ö†Ô∏è Points d'attention

1. **Coordonn√©es manquantes** : Pas de g√©olocalisation initiale (√† pr√©voir)
2. **Calendrier r√©publicain** : Mapping `V_an_*` n√©cessaire
3. **Performance** : Clustering obligatoire pour gros volumes
4. **Accessibilit√©** : Alternative tabulaire √† la carte

---

**Prochaine √©tape** : Commencer par l'√âtape 1 (squelette Hugo)
